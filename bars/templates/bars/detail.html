{% extends 'base.html' %}
{% load static %}
{% load django_bootstrap5 %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/style.css' %}">
<link rel="stylesheet" href="{% static './static/blog.css' %}" >
{% endblock %}

{% block content %}
<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>     
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"></script>
<script type="text/javascript" src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<link href="../../../../dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">


<style>
  .pop-out-card {
  float: left;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  border: solid 1px #bbb;
  transition: all .2s;
  font: normal 16px calibri;
}
.pop-out-card:hover {
  box-shadow: 2px 12px 15px #999;
}
.pop-out-card.with-transform:hover {
  transform: translateY(-2px);
}

.blog-header {
  line-height: 1;
  border-bottom: 1px solid #e5e5e5;
}

.blog-header-logo {
  font-family: "Playfair Display", Georgia, "Times New Roman", serif;
  font-size: 2.25rem;
}

.blog-header-logo:hover {
  text-decoration: none;
}

h1, h2, h3, h4, h5, h6 {
  font-family: "Playfair Display", Georgia, "Times New Roman", serif;
}

.display-4 {
  font-size: 2.5rem;
}
@media (min-width: 768px) {
  .display-4 {
    font-size: 3rem;
  }
}

.nav-scroller {
  position: relative;
  z-index: 2;
  height: 2.75rem;
  overflow-y: hidden;
}

.nav-scroller .nav {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: nowrap;
  flex-wrap: nowrap;
  padding-bottom: 1rem;
  margin-top: -1px;
  overflow-x: auto;
  text-align: center;
  white-space: nowrap;
  -webkit-overflow-scrolling: touch;
}

.nav-scroller .nav-link {
  padding-top: .75rem;
  padding-bottom: .75rem;
  font-size: .875rem;
}

.card-img-right {
  height: 100%;
  border-radius: 0 3px 3px 0;
}

.flex-auto {
  -ms-flex: 0 0 auto;
  -webkit-box-flex: 0;
  flex: 0 0 auto;
}

.h-250 { height: 250px; }
@media (min-width: 768px) {
  .h-md-250 { height: 250px; }
}

.border-top { border-top: 1px solid #e5e5e5; }
.border-bottom { border-bottom: 1px solid #e5e5e5; }

.box-shadow { box-shadow: 0 .25rem .75rem rgba(0, 0, 0, .05); }

/*
 * Blog name and description
 */
.blog-title {
  margin-bottom: 0;
  font-size: 2rem;
  font-weight: 400;
}
.blog-description {
  font-size: 1.1rem;
  color: #999;
}

@media (min-width: 40em) {
  .blog-title {
    font-size: 3.5rem;
  }
}

/* Pagination */
.blog-pagination {
  margin-bottom: 4rem;
}
.blog-pagination > .btn {
  border-radius: 2rem;
}

/*
 * Blog posts
 */
.blog-post {
  margin-bottom: 4rem;
}
.blog-post-title {
  margin-bottom: .25rem;
  font-size: 2.5rem;
}
.blog-post-meta {
  margin-bottom: 1.25rem;
  color: #999;
}

/*
 * Footer
 */
.blog-footer {
  padding: 2.5rem 0;
  color: #999;
  text-align: center;
  background-color: #f9f9f9;
  border-top: .05rem solid #e5e5e5;
}
.blog-footer p:last-child {
  margin-bottom: 0;
}

</style>


<div class="row">
  <div class="col-md-4 mb-0">
    <div class="pop-out-card with-transform">
      <img class="img-fluid" alt="100%x280" src="{{ restaurant.picture1 }}">
    </div>
  </div>
  <div class="col-md-4 mb-0">
    <div class="pop-out-card with-transform">
      <img class="img-fluid" alt="100%x280" src="{{ restaurant.picture2 }}">
    </div>
  </div>
  <div class="col-md-4 mb-0">
    <div class="pop-out-card with-transform">
      <img class="img-fluid" alt="100%x280" src="{{ restaurant.picture3 }}">
    </div>
  </div>    
</div>


<div class="jumbotron p-3 p-md-5 text-white rounded bg-dark">
  <div class="col-md-6 px-0">
    <h1 class="display-4 font-italic">{{ restaurant.name }}</h1>
  </div>
</div>

<main role="main" class="container">
  <div class="row">
    <div class="col-md-8 blog-main">
      <div class="blog-post">
        <p class="blog-post-meta">{{ restaurant.like_users.count }} 좋아요 
          <a class="btn btn-primary" href="{% url 'bars:review' restaurant.pk %}">
          리뷰 작성하기
          </a>
        </p>
        <hr>

        <div> 
          <div class="justify-content-between m-0 align-items-center">
            <p>주소 :   {{ restaurant.address }} </p> 
            <p>카테고리 :   {{ restaurant.category }}</p> 
            <p>전화번호 :   {{ restaurant.phone }}</p>
            <p>영업시간 :   {{ restaurant.hours }}</p>
            <p>주소 :   {{ restaurant.address }}</p>
            <p>지도: <a href="{{ restaurant.map_url }}">네이버 플레이스에서 위치 확인</a></p>
          </div>
        </div>


        <div>
          <h2>식당 상세 내용</h2> 
          <hr>
          <div class="container" style="height: 300px;">
            <form class="d-flex w-75 h-25">
              <p>{{ restaurant.content }}</p>
            </form>
          </div>
        </div>
        <hr>
        <br>

        <h2>{{ restaurant.name }} 리뷰</h2> 
        <hr>
        <div class="container mt-3">
        {% for review in reviews %}
          <div class="d-flex justify-content-between">
            <div class="d-flex">
              <a href="{% url 'accounts:userpage' review.user.pk %}"><p class="fw-bold">{{ review.user.username }}</p></a>
            </div>
            <div class="">
              <p class="m-0">{{ review.updated_at }}</p>
              <div class="d-flex justify-content-end">
                <p class="fw-bold m-0">{{ review.get_grade_display }}</p>
              </div>
            </div>
          </div>
          
          <p class="fw-bold">{{ review.title }}</p>
          <p>{{ review.content }}</p>







<p>좋아요 개수</p>
{% if request.user.is_authenticated %}
<a class="like-heart" href="{% url 'bars:like' restaurant.pk %}">
  {% if request.user in restaurant.like_users.all %}
  <i class="bi bi-heart-fill"></i>
  {% else %}
  <i class="bi bi-heart"></i>
  {% endif %}</a>{{ restaurant.like_users.count }}</span>
{% endif %}


  <!-- 수정/삭제 -->
  <div class="text-end">
    <div class="d-flex justify-content-end">
      <a class="btn btn-outline-primary" href="{% url 'bars:update' restaurant.pk review.pk %}">
        <i class="fa-solid fa-pen"></i>

      </a>
      <!-- <div class="text-end me-5"> -->
      <p>{{ comment.content }}</p>
      {% comment %} 댓글 삭제 버튼 {% endcomment %}
      <button type="submit" class="btn btn-outline-danger ms-2" data-bs-toggle="modal" data-bs-target="#exampleModal">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-trash"
          viewbox="0 0 16 16">
          <path
            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z" />
          <path fill-rule="evenodd"
            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z" />
        </svg>
      </button>
    </div>
  </div>

  <!-- Modal -->
  <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="exampleModalLabel">주의!</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>정말 삭제를 원하시나요?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">잘못눌렀어!</button>
          <a href="{% url 'bars:delete' restaurant.pk review.pk %}">
            <button type="button" class="btn btn-primary">정말 삭제를 원해!</button>
          </a>
        </div>
      </div>
    </div>
  </div>
    <!-- Button trigger modal -->
  <button type="button" class="btn btn-primary mb-5" data-bs-toggle="modal" data-bs-target="#staticBackdrop-{{ review.id }}">
    댓글 달기ll
  </button>

  <!-- Modal -->
  <div class="modal fade" id="staticBackdrop-{{ review.pk }}" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="staticBackdropLabel">댓글을 작성하세요</h1>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form action="{% url 'bars:comment_create' restaurant.pk review.pk %}" method="POST">
            {% csrf_token %}
            {% bootstrap_form comment_form layout='inline'%}
            {% comment %} <input type="hidden" name="review" value={{ review.id }}> {% endcomment %}
            {% comment %} {% bootstrap_button button_type="submit" content="등록" button_class="btn-primary" %} {% endcomment %}
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
              {% bootstrap_button button_type="submit" content="등록" button_class="btn-primary" %}
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- 댓글 -->
  <i class="bi bi-chat"></i>
  {% if review.comment_set.all %}
  {{ review.comment_set.all|length }}
  {% endif %}

  {% for comment in review.comment_set.all %}
  <p>{{ comment.content }}</p>
  <a href="{% url 'bars:comment_delete' restaurant.pk comment.pk %}">삭제</a>
  <hr>
  {% empty %}
  <p>댓글이 없습니다.</p>
  {% endfor %}
</div>

{% endfor %}
<!-- <div class="text-end me-5">
  <a class="btn btn-primary" href="{% url 'bars:review' restaurant.pk %}">
    리뷰 작성하기
  </a>
</div> -->
      <aside class="col-md-4 blog-sidebar">
        <div class="p-3 mb-3 bg-light rounded">
          <h4 class="font-italic">지도</h4>
          <li><a href="{{ restaurant.map_url }}">네이버 플레이스에서 위치 확인</a></li>
        </div>
      </aside>
    </div>
  </div>
</main>
{% endblock %}

<!-- 좋아요를 누르면 특정 리뷰에 대한 좋아요가 아니라 모든 리뷰에 좋아요로 눌린다. -->
<!-- 별점 평점 계산해주는 기능필요 -->
<!-- 레스토랑 콘텐츠 내용 없음 -->
<!-- 크롤링에서 레스토랑 컨텐츠와 리뷰를 크롤링해오지 않고 사진이 3개만 있음 -->